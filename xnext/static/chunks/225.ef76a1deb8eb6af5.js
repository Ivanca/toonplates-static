(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[225],{4960:function(){},6759:function(){},6272:function(){},7730:function(e,t,i){"use strict";i.r(t),i.d(t,{Editor:function(){return ed},EditorWithStore:function(){return en}});var a=i(9268),n=i(1003),l=i(6006),s=i(4357);function r(){return Math.random().toString(36).substring(2,9)}function o(e){return!!e&&"VIDEO"===e.tagName}function d(e){return!!e&&"AUDIO"===e.tagName}function c(e){return"".concat(Math.floor(e/60),":").concat(h(Math.floor(e%60),2))}function m(e){let t=Math.floor(e%1e3/10);return c(e/1e3)+".".concat(h(t,2))}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toString().padStart(t,"0")}var p=i(5459);let u=n.fabric.util.createClass(n.fabric.Image,{type:"coverImage",customFilter:"none",disableCrop:!1,cropWidth:0,cropHeight:0,initialize(e,t){t=t||{},t=Object.assign({cropHeight:this.height,cropWidth:this.width},t),this.callSuper("initialize",e,t)},getCrop(e,t){let i,a;let n=t.width,l=t.height,s=n/l,r=e.width/e.height;s>=r?(i=e.width,a=e.width/s):(i=e.height*s,a=e.height);let o=(e.width-i)/2,d=(e.height-a)/2;return{cropX:o,cropY:d,cropWidth:i,cropHeight:a}},_render(e){if(this.disableCrop){this.callSuper("_render",e);return}let t=this.width,i=this.height,a=this.getCrop(this.getOriginalSize(),{width:this.getScaledWidth(),height:this.getScaledHeight()}),{cropX:n,cropY:l,cropWidth:s,cropHeight:r}=a;e.save();let o=this.customFilter;e.filter=g(o),e.drawImage(this._element,Math.max(n,0),Math.max(l,0),Math.max(1,s),Math.max(1,r),-t/2,-i/2,Math.max(0,t),Math.max(0,i)),e.filter="none",e.restore()}}),x=n.fabric.util.createClass(n.fabric.Image,{type:"coverVideo",customFilter:"none",disableCrop:!1,cropWidth:0,cropHeight:0,initialize(e,t){t=t||{},t=Object.assign({cropHeight:this.height,cropWidth:this.width},t),this.callSuper("initialize",e,t)},getCrop(e,t){let i,a;let n=t.width,l=t.height,s=n/l,r=e.width/e.height;s>=r?(i=e.width,a=e.width/s):(i=e.height*s,a=e.height);let o=(e.width-i)/2,d=(e.height-a)/2;return{cropX:o,cropY:d,cropWidth:i,cropHeight:a}},_render(e){if(this.disableCrop){this.callSuper("_render",e);return}let t=this.width,i=this.height,a=this.getCrop(this.getOriginalSize(),{width:this.getScaledWidth(),height:this.getScaledHeight()}),{cropX:n,cropY:l,cropWidth:s,cropHeight:r}=a,o=this._element,d=o.width/o.videoWidth,c=o.height/o.videoHeight;e.save();let m=this.customFilter;e.filter=g(m),e.drawImage(this._element,Math.max(n,0)/d,Math.max(l,0)/c,Math.max(1,s)/d,Math.max(1,r)/c,-t/2,-i/2,Math.max(0,t),Math.max(0,i)),e.filter="none",e.restore()}});function g(e){switch(e){case"blackAndWhite":return"grayscale(100%)";case"sepia":return"sepia(100%)";case"invert":return"invert(100%)";case"saturate":return"saturate(100%)";default:return"none"}}n.fabric.CoverImage=u,n.fabric.CoverVideo=x;class f{static getClipMaskRect(e,t){let i=t/e.placement.scaleX,a=i/e.placement.scaleY,l=new n.fabric.Rect({left:e.placement.x-i,top:e.placement.y-a,width:e.placement.width+2*i,height:e.placement.height+2*a,scaleX:e.placement.scaleX,scaleY:e.placement.scaleY,absolutePositioned:!0,fill:"transparent",stroke:"transparent",opacity:.5,strokeWidth:0});return l}}var v=i(8944),b=i(4453);class y{get currentTimeInMs(){return 1e3*this.currentKeyFrame/this.fps}setCurrentTimeInMs(e){this.currentKeyFrame=Math.floor(e/1e3*this.fps)}setSelectedMenuOption(e){this.selectedMenuOption=e}setCanvas(e){this.canvas=e,e&&(e.backgroundColor=this.backgroundColor)}setFontFamily(e){this.fontFamily=e}setIsExporting(e){this.isExporting=e}setBackgroundColor(e){this.backgroundColor=e,this.canvas&&(this.canvas.backgroundColor=e)}updateEffect(e,t){let i=this.editorElements.findIndex(t=>t.id===e),a=this.editorElements[i];(w(a)||E(a))&&(a.properties.effect=t),this.refreshElements()}setPostProcessingFn(e){this.postProcessingFn=e}setVideos(e){this.videos=e}addVideoResource(e){this.videos=[...this.videos,e]}addAudioResource(e){this.audios=[...this.audios,e]}addImageResource(e){this.images=[...this.images,e]}addAnimation(e){this.animations=[...this.animations,e],this.refreshAnimations()}updateAnimation(e,t){let i=this.animations.findIndex(t=>t.id===e);this.animations[i]=t,this.refreshAnimations()}refreshAnimations(){p.Z.remove(this.animationTimeLine),this.animationTimeLine=p.Z.timeline({duration:this.maxTime,autoplay:!1});for(let d=0;d<this.animations.length;d++){var e,t,i,a,l,s,r,o;let c=this.animations[d],m=this.editorElements.find(e=>e.id===c.targetId),h=null==m?void 0:m.fabricObject;if(m&&h)switch(h.clipPath=void 0,c.type){case"positionAndScale":this.animationTimeLine.add({left:[m.placement.x,c.properties.x],top:[m.placement.y,c.properties.y],scaleX:[m.placement.scaleX,c.properties.scale],scaleY:[m.placement.scaleY,c.properties.scale],duration:c.duration,targets:h,easing:null!==(e=c.properties.easing)&&void 0!==e?e:"linear"},m.timeFrame.start+c.properties.startDelay);break;case"fadeIn":this.animationTimeLine.add({opacity:[0,1],duration:c.duration,targets:h,easing:"linear"},m.timeFrame.start);break;case"fadeOut":this.animationTimeLine.add({opacity:[1,0],duration:c.duration,targets:h,easing:"linear"},m.timeFrame.end-c.duration);break;case"slideIn":{let e=c.properties.direction,l={left:m.placement.x,top:m.placement.y},s={left:"left"===e?-m.placement.width:"right"===e?null===(t=this.canvas)||void 0===t?void 0:t.width:m.placement.x,top:"top"===e?-m.placement.height:"bottom"===e?null===(i=this.canvas)||void 0===i?void 0:i.height:m.placement.y};if(c.properties.useClipPath){let e=f.getClipMaskRect(m,50);h.set("clipPath",e)}if("text"===m.type&&"character"===c.properties.textType){null===(a=this.canvas)||void 0===a||a.remove(...m.properties.splittedTexts),m.properties.splittedTexts=function(e,t){var i,a,l;let s=[],r=(null!==(i=e.text)&&void 0!==i?i:"").split("").filter(e=>"\n"!==e),o=e.__charBounds;if(!o)return[];let d=o.map((e,t)=>e.slice(0,e.length-1).map(e=>({m:e,index:t}))).flat(),c=e.getHeightOfLine(0);for(let i=0;i<r.length;i++){if(!d[i])continue;let{m:o,index:m}=d[i],h=r[i],p=null!==(a=e.scaleX)&&void 0!==a?a:1,u=null!==(l=e.scaleY)&&void 0!==l?l:1,x=new n.fabric.Text(h,{left:o.left*p+t.placement.x,scaleX:p,scaleY:u,top:m*c*u+t.placement.y,fontSize:e.fontSize,fontWeight:e.fontWeight,fill:"#fff"});s.push(x)}return s}(m.fabricObject,m),m.properties.splittedTexts.forEach(e=>{this.canvas.add(e)});let e=c.duration/2,t=e/m.properties.splittedTexts.length;for(let i=0;i<m.properties.splittedTexts.length;i++){let a=m.properties.splittedTexts[i],n={left:a.left-m.placement.x,top:a.top-m.placement.y};this.animationTimeLine.add({left:[s.left+n.left,l.left+n.left],top:[s.top+n.top,l.top+n.top],delay:i*t,duration:e,targets:a},m.timeFrame.start)}this.animationTimeLine.add({opacity:[1,0],duration:1,targets:h,easing:"linear"},m.timeFrame.start),this.animationTimeLine.add({opacity:[0,1],duration:1,targets:h,easing:"linear"},m.timeFrame.start+c.duration),this.animationTimeLine.add({opacity:[0,1],duration:1,targets:m.properties.splittedTexts,easing:"linear"},m.timeFrame.start),this.animationTimeLine.add({opacity:[1,0],duration:1,targets:m.properties.splittedTexts,easing:"linear"},m.timeFrame.start+c.duration)}this.animationTimeLine.add({left:[s.left,l.left],top:[s.top,l.top],duration:c.duration,targets:h,easing:"linear"},m.timeFrame.start);break}case"slideOut":{let e=c.properties.direction,t={left:m.placement.x,top:m.placement.y},i={left:"left"===e?-m.placement.width:"right"===e?null===(l=this.canvas)||void 0===l?void 0:l.width:m.placement.x,top:"top"===e?-100-m.placement.height:"bottom"===e?null===(s=this.canvas)||void 0===s?void 0:s.height:m.placement.y};if(c.properties.useClipPath){let e=f.getClipMaskRect(m,50);h.set("clipPath",e)}this.animationTimeLine.add({left:[t.left,i.left],top:[t.top,i.top],duration:c.duration,targets:h,easing:"linear"},m.timeFrame.end-c.duration);break}case"breathe":{let e=this.animations.find(e=>e.targetId===c.targetId&&"slideIn"===e.type),t=this.animations.find(e=>e.targetId===c.targetId&&"slideOut"===e.type),i=e?m.timeFrame.start+e.duration:m.timeFrame.start,a=t?m.timeFrame.end-t.duration:m.timeFrame.end;if(i>a)continue;let n=a-i,l=6e4/72*4,s=null!==(r=h.scaleX)&&void 0!==r?r:1,d=null!==(o=h.scaleY)&&void 0!==o?o:1,p=1.05*s,u=1.05*d,x=Math.floor(n/l);if(x<1)continue;let g=[];for(let e=0;e<x;e++)g.push({scaleX:p,scaleY:u}),g.push({scaleX:s,scaleY:d});this.animationTimeLine.add({duration:n,targets:h,keyframes:g,easing:"linear",loop:!0},i)}}}}removeAnimation(e){this.animations=this.animations.filter(t=>t.id!==e),this.refreshAnimations()}setSelectedElement(e){this.selectedElement=e,this.canvas&&((null==e?void 0:e.fabricObject)?this.canvas.setActiveObject(e.fabricObject):this.canvas.discardActiveObject())}updateSelectedElement(){var e;this.selectedElement=null!==(e=this.editorElements.find(e=>{var t;return e.id===(null===(t=this.selectedElement)||void 0===t?void 0:t.id)}))&&void 0!==e?e:null}setEditorElements(e){this.editorElements=e,this.updateSelectedElement(),this.refreshElements()}updateEditorElement(e){this.setEditorElements(this.editorElements.map(t=>t.id===e.id?e:t))}updateEditorElementTimeFrame(e,t){void 0!=t.start&&t.start<0&&(t.start=0),void 0!=t.end&&t.end>this.maxTime&&(t.end=this.maxTime);let i={...e,timeFrame:{...e.timeFrame,...t}};this.updateVideoElements(),this.updateAudioElements(),this.updateEditorElement(i),this.refreshAnimations()}addEditorElement(e){this.setEditorElements([...this.editorElements,e]),this.refreshElements(),this.setSelectedElement(this.editorElements[this.editorElements.length-1])}removeEditorElement(e){this.setEditorElements(this.editorElements.filter(t=>t.id!==e)),this.refreshElements()}setMaxTime(e){this.maxTime=e}setPlaying(e){this.playing=e,this.updateVideoElements(),this.updateAudioElements(),e&&(this.startedTime=Date.now(),this.startedTimePlay=this.currentTimeInMs,requestAnimationFrame(()=>{this.playFrames()}))}playFrames(){if(!this.playing)return;let e=Date.now()-this.startedTime,t=this.startedTimePlay+e;this.updateTimeTo(t),t>this.maxTime?(this.currentKeyFrame=0,this.setPlaying(!1)):requestAnimationFrame(()=>{this.playFrames()})}updateTimeTo(e){this.setCurrentTimeInMs(e),this.animationTimeLine.seek(e),this.canvas&&(this.canvas.backgroundColor=this.backgroundColor),this.editorElements.forEach(t=>{if(!t.fabricObject)return;let i=t.timeFrame.start<=e&&e<=t.timeFrame.end;t.fabricObject.visible=i})}handleSeek(e){this.playing&&this.setPlaying(!1),this.updateTimeTo(e),this.updateVideoElements(),this.updateAudioElements()}addVideo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=document.getElementById("video-".concat(e));if(!o(i))return;let a=1e3*i.duration,n=i.videoHeight/i.videoWidth,l=r();this.addEditorElement({id:l,name:"Media(video) ".concat(e+1),type:"video",placement:{x:0,y:0,width:t,height:t*n,rotation:0,scaleX:1,scaleY:1},timeFrame:{start:0,end:a},properties:{elementId:"video-".concat(l),src:i.src,effect:{type:"none"}}})}addImage(e,t){var i,a,n,l,s,o,d,c,m,h;let p;"number"==typeof e?p=document.getElementById("image-".concat(e)):(p=new Image).src=e;let u=p.naturalWidth/p.naturalHeight,x=r();this.addEditorElement({id:x,name:null!==(i=null==t?void 0:t.name)&&void 0!==i?i:"Media(image) ".concat(x),type:"image",placement:{x:null!==(a=null==t?void 0:t.x)&&void 0!==a?a:0,y:null!==(n=null==t?void 0:t.y)&&void 0!==n?n:0,width:null!==(l=null==t?void 0:t.width)&&void 0!==l?l:100*u,height:null!==(s=null==t?void 0:t.height)&&void 0!==s?s:100,rotation:null!==(o=null==t?void 0:t.rotation)&&void 0!==o?o:0,scaleX:null!==(d=null==t?void 0:t.scale)&&void 0!==d?d:1,scaleY:null!==(c=null==t?void 0:t.scale)&&void 0!==c?c:1},timeFrame:{start:null!==(m=null==t?void 0:t.start)&&void 0!==m?m:0,end:null!==(h=null==t?void 0:t.end)&&void 0!==h?h:this.maxTime},properties:{elementId:"image-".concat(x),src:p.src,effect:{type:"none"}}})}addAudio(e){let t=document.getElementById("audio-".concat(e));if(!d(t))return;let i=1e3*t.duration,a=r();this.addEditorElement({id:a,name:"Media(audio) ".concat(e+1),type:"audio",placement:{x:0,y:0,width:100,height:100,rotation:0,scaleX:1,scaleY:1},timeFrame:{start:0,end:i},properties:{elementId:"audio-".concat(a),src:t.src}})}addText(e){var t,i,a,n,l,s,o,d,c,m,h;let p=r(),u=this.editorElements.length;this.addEditorElement({id:p,name:null!==(t=e.name)&&void 0!==t?t:"Text ".concat(u+1),type:"text",placement:{x:null!==(i=e.x)&&void 0!==i?i:0,y:null!==(a=e.y)&&void 0!==a?a:0,width:null!==(n=e.width)&&void 0!==n?n:100,height:null!==(l=e.height)&&void 0!==l?l:100,rotation:null!==(s=e.rotation)&&void 0!==s?s:0,scaleX:null!==(o=null==e?void 0:e.scale)&&void 0!==o?o:1,scaleY:null!==(d=null==e?void 0:e.scale)&&void 0!==d?d:1},timeFrame:{start:null!==(c=e.start)&&void 0!==c?c:0,end:null!==(m=e.end)&&void 0!==m?m:this.maxTime},properties:{text:e.text,fontSize:e.fontSize,fontWeight:e.fontWeight,fontFamily:this.fontFamily,fill:null!==(h=e.fill)&&void 0!==h?h:"#ffffff",splittedTexts:[]}})}updateVideoElements(){this.editorElements.filter(e=>"video"===e.type).forEach(e=>{let t=document.getElementById(e.properties.elementId);if(o(t)){let i=(this.currentTimeInMs-e.timeFrame.start)/1e3;t.currentTime=i,this.playing?t.play():t.pause()}})}updateAudioElements(){this.editorElements.filter(e=>"audio"===e.type).forEach(e=>{let t=document.getElementById(e.properties.elementId);if(d(t)){let i=(this.currentTimeInMs-e.timeFrame.start)/1e3;t.currentTime=i,this.playing?t.play():t.pause()}})}setVideoFormat(e){this.selectedVideoFormat=e}saveCanvasToVideoWithAudioMp4(){let e=this,t=document.getElementById("canvas");if(!t)return;let i=t.getContext("2d");if(!i)return;let a=[],n=this.maxTime,l=this.fps,s=1e3/l,r=0;var o=";base64,";async function d(){let e="https://unpkg.com/@ffmpeg/core@0.12.2/dist/umd",t=new v.C;t.on("progress",e=>{}),t.on("log",e=>{}),await t.load({coreURL:await (0,b.Wn)("".concat(e,"/ffmpeg-core.js"),"text/javascript"),wasmURL:await (0,b.Wn)("".concat(e,"/ffmpeg-core.wasm"),"application/wasm")});let i=a.map((e,i)=>{let a="img_".concat(String(i).padStart(4,"0"),".jpeg"),n=function(e){var t=e.indexOf(o)+o.length,i=e.substring(t),a=window.atob(i),n=a.length,l=new Uint8Array(new ArrayBuffer(n));for(let e=0;e<n;e++)l[e]=a.charCodeAt(e);return l}(e);t.writeFile(a,n)});await Promise.all(i),await t.exec(["-f","image2","-analyzeduration","2147483647","-probesize","2147483647","-i","img_%04d.jpeg","-vf","fps=".concat(l,",pad=ceil(iw/2)*2:ceil(ih/2)*2"),"out.mp4"]);let n=await t.readFile("out.mp4"),s=new Blob([n],{type:"video/mp4"}),r=document.getElementById("output-video"),d=URL.createObjectURL(s),c=document.createElement("a");c.href=d,c.download="video.mp4",c.click(),r?r.src=d:((r=document.createElement("video")).height=540,r.width=960,r.id="output-video",r.src=d,r.controls=!0,document.body.appendChild(r))}let c=setInterval(()=>{!function(){if(!i)return;e.handleSeek(r),null!==e.postProcessingFn&&e.postProcessingFn(i,r);let n=t.toDataURL("image/jpeg",1);a.push(n)}(),(r+=s)>=n&&(clearInterval(c),d())},s)}saveCanvasToVideoWithAudio(){var e;let t=document.getElementById("canvas"),i=t.captureStream(30),a=this.editorElements.filter(j),n=[];a.forEach(e=>{let t=document.getElementById(e.properties.elementId),i=new AudioContext,a=i.createMediaElementSource(t),l=i.createMediaStreamDestination();a.connect(l),a.connect(i.destination),n.push(l.stream)}),n.forEach(e=>{i.addTrack(e.getAudioTracks()[0])});let l=document.createElement("video");l.srcObject=i,l.height=540,l.width=960,l.muted=!0,l.id="output-video",l.autoplay=!1,null===(e=document.querySelector("#output-video"))||void 0===e||e.remove(),document.body.appendChild(l),l.classList.add("hide-but-render"),setTimeout(()=>{l.play().then(()=>{let e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),t=new MediaRecorder(i,{mimeType:e?"video/webm; codecs=vp8":"video/x-matroska;codecs=avc1"}),a=[];t.ondataavailable=function(e){0===e.data.size&&console.log("data size is 0",e,t,a),a.push(e.data)},t.onstop=async t=>{let i=new Blob(a,{type:"video/webm"}),n=()=>{let e=URL.createObjectURL(i),t=document.createElement("a");t.href=e,t.download="video.webm",t.click(),this.setIsExporting(!1),document.querySelector(".example-gag").src=e};if(e)n();else try{let e=new Uint8Array(await i.arrayBuffer()),t=new v.C,a="https://unpkg.com/@ffmpeg/core@0.12.2/dist/umd";await t.load({coreURL:await (0,b.Wn)("".concat(a,"/ffmpeg-core.js"),"text/javascript"),wasmURL:await (0,b.Wn)("".concat(a,"/ffmpeg-core.wasm"),"application/wasm")}),await t.writeFile("video.webm",e),await t.exec(["-y","-i","video.webm","-c","copy","video.mp4"]);let n=await t.readFile("video.mp4"),l=new Blob([n],{type:"video/mp4"}),s=URL.createObjectURL(l),r=document.createElement("a");r.download="video.mp4",r.href=s,r.click(),this.setIsExporting(!1),document.querySelector(".example-gag").src=s}catch(e){console.log(e),n()}},t.onstart=e=>{this.setPlaying(!0),setTimeout(()=>{t.stop()},this.maxTime)},t.start()})},1e3)}refreshElements(){let e=this;if(!e.canvas)return;let t=e.canvas;e.canvas.remove(...e.canvas.getObjects());for(let i=0;i<e.editorElements.length;i++){let a=e.editorElements[i];switch(a.type){case"video":{if(null==document.getElementById(a.properties.elementId))continue;let i=document.getElementById(a.properties.elementId);if(!o(i))continue;let l=new n.fabric.CoverVideo(i,{name:a.id,left:a.placement.x,top:a.placement.y,width:a.placement.width,height:a.placement.height,scaleX:a.placement.scaleX,scaleY:a.placement.scaleY,angle:a.placement.rotation,objectCaching:!1,selectable:!0,lockUniScaling:!0,customFilter:a.properties.effect.type});a.fabricObject=l,a.properties.imageObject=l,i.width=100,i.height=100*i.videoHeight/i.videoWidth,t.add(l),t.on("object:modified",function(t){var i,n,s;if(!t.target)return;let r=t.target;if(r!=l)return;let o=a.placement,d={...o,x:null!==(i=r.left)&&void 0!==i?i:o.x,y:null!==(n=r.top)&&void 0!==n?n:o.y,rotation:null!==(s=r.angle)&&void 0!==s?s:o.rotation,width:r.width&&r.scaleX?r.width*r.scaleX:o.width,height:r.height&&r.scaleY?r.height*r.scaleY:o.height,scaleX:1,scaleY:1},c={...a,placement:d};e.updateEditorElement(c)});break}case"image":{if(null==document.getElementById(a.properties.elementId))continue;let i=document.getElementById(a.properties.elementId);if(!(i&&"IMG"===i.tagName))continue;let l=new n.fabric.CoverImage(i,{name:a.id,left:a.placement.x,top:a.placement.y,angle:a.placement.rotation,objectCaching:!1,selectable:!0,lockUniScaling:!0,customFilter:a.properties.effect.type});a.fabricObject=l,a.properties.imageObject=l;let s={w:i.naturalWidth,h:i.naturalHeight};l.width=s.w,l.height=s.h,i.width=s.w,i.height=s.h,l.scaleToHeight(s.w),l.scaleToWidth(s.h);let r={x:a.placement.width/s.w,y:a.placement.height/s.h};l.scaleX=r.x*a.placement.scaleX,l.scaleY=r.y*a.placement.scaleY,t.add(l),t.on("object:modified",function(t){var i,n,s;if(!t.target)return;let o=t.target;if(o!=l)return;let d=a.placement,c=1;o.scaleX&&o.scaleX>0&&(c=o.scaleX/r.x);let m={...d,x:null!==(i=o.left)&&void 0!==i?i:d.x,y:null!==(n=o.top)&&void 0!==n?n:d.y,rotation:null!==(s=o.angle)&&void 0!==s?s:d.rotation,scaleX:c,scaleY:c},h={...a,placement:m};e.updateEditorElement(h)});break}case"audio":break;case"text":{let i=new n.fabric.Textbox(a.properties.text,{name:a.id,left:a.placement.x,top:a.placement.y,scaleX:a.placement.scaleX,scaleY:a.placement.scaleY,width:a.placement.width,height:a.placement.height,angle:a.placement.rotation,fontSize:a.properties.fontSize,fontWeight:a.properties.fontWeight,fontFamily:a.properties.fontFamily,objectCaching:!1,selectable:!0,lockUniScaling:!0,fill:a.properties.fill});a.fabricObject=i,t.add(i),t.on("object:modified",function(t){var n,l,s,r,o,d,c;if(!t.target)return;let m=t.target;if(m!=i)return;let h=a.placement,p={...h,x:null!==(n=m.left)&&void 0!==n?n:h.x,y:null!==(l=m.top)&&void 0!==l?l:h.y,rotation:null!==(s=m.angle)&&void 0!==s?s:h.rotation,width:null!==(r=m.width)&&void 0!==r?r:h.width,height:null!==(o=m.height)&&void 0!==o?o:h.height,scaleX:null!==(d=m.scaleX)&&void 0!==d?d:h.scaleX,scaleY:null!==(c=m.scaleY)&&void 0!==c?c:h.scaleY},u={...a,placement:p,properties:{...a.properties,text:null==m?void 0:m.text}};e.updateEditorElement(u)});break}default:throw Error("Not implemented")}a.fabricObject&&a.fabricObject.on("selected",function(t){e.setSelectedElement(a)})}let i=e.selectedElement;i&&i.fabricObject&&t.setActiveObject(i.fabricObject),this.refreshAnimations(),this.updateTimeTo(this.currentTimeInMs),e.canvas.renderAll()}constructor(){this.isExporting=!1,this.possibleVideoFormats=["mp4","webm"],this.startedTime=0,this.startedTimePlay=0,this.canvas=null,this.videos=[],this.images=[],this.audios=[],this.editorElements=[],this.backgroundColor="#111111",this.fontFamily="Arial",this.maxTime=3e4,this.playing=!1,this.currentKeyFrame=0,this.selectedElement=null,this.postProcessingFn=null,this.fps=60,this.animations=[],this.animationTimeLine=p.Z.timeline(),this.selectedMenuOption="Video",this.selectedVideoFormat="mp4",(0,s.ky)(this)}}function j(e){return"audio"===e.type}function w(e){return"video"===e.type}function E(e){return"image"===e.type}let N=(0,l.createContext)(new y);var C=i(2639);let k=(0,C.Pi)(()=>{let e=l.useContext(N);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Export"}),(0,a.jsxs)("div",{className:"px-[16px]",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center my-2",children:[(0,a.jsx)("div",{className:"text-xs font-semibold mr-2",children:"Video Length:"}),(0,a.jsx)("input",{type:"number",className:"rounded text-center border-slate-200 placeholder-slate-400 contrast-more:border-slate-400 contrast-more:placeholder-slate-500 max-w-[50px] mr-2",value:e.maxTime/1e3,onChange:t=>{let i=t.target.value;e.setMaxTime(1e3*Number(i))}}),(0,a.jsx)("div",{children:"secs"})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center my-2",children:[(0,a.jsx)("div",{className:"text-xs font-semibold mr-2",children:"Canvas Resolution:"}),(0,a.jsx)("div",{className:"text-xs mr-2",children:"Todo"})]})]}),(0,a.jsxs)("div",{className:"px-[16px]",children:[(0,a.jsx)("div",{className:"text-xs font-semibold mr-2",children:"Video Format:"}),(0,a.jsxs)("div",{className:"flex flex-row items-center my-2",children:[(0,a.jsx)("input",{type:"radio",className:"mr-2",name:"video-format",value:"mp4",checked:"mp4"===e.selectedVideoFormat,onChange:t=>{e.setVideoFormat("mp4")}}),(0,a.jsx)("div",{className:"text-xs mr-2",children:"MP4"}),(0,a.jsx)("input",{type:"radio",className:"mr-2",name:"video-format",value:"gif",checked:"webm"===e.selectedVideoFormat,onChange:t=>{e.setVideoFormat("webm")}}),(0,a.jsx)("div",{className:"text-xs mr-2",children:"webm"})]})]}),(0,a.jsxs)("button",{className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-1 px-1 rounded-lg m-4",onClick:()=>{e.handleSeek(0),e.setSelectedElement(null),setTimeout(()=>{e.saveCanvasToVideoWithAudio()},1e3)},children:["Export Video (",e.maxTime/1e3," secs) ","mp4"===e.selectedVideoFormat?"ALPHA":""]})]})});var T=i(4821);let F={fadeIn:"Fade In",fadeOut:"Fade Out",slideIn:"Slide In",slideOut:"Slide Out",breath:"Breath"},I=(0,C.Pi)(e=>{let t=l.useContext(N);return(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden items-center bg-slate-800 m-[15px] flex flex-col relative min-h-[100px] p-2",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between w-full",children:[(0,a.jsx)("div",{className:"text-white py-1 text-base text-left w-full",children:F[e.animation.type]}),(0,a.jsx)("button",{className:"hover:bg-[#00a0f5] bg-[rgba(0,0,0,.25)] rounded z-10 text-white font-bold py-1 text-lg",onClick:()=>t.removeAnimation(e.animation.id),children:(0,a.jsx)(T.ZkW,{size:"25"})})]}),"fadeIn"===e.animation.type||"fadeOut"===e.animation.type?(0,a.jsx)(S,{animation:e.animation}):null,"slideIn"===e.animation.type||"slideOut"===e.animation.type?(0,a.jsx)(A,{animation:e.animation}):null]})}),S=(0,C.Pi)(e=>{let t=l.useContext(N);return(0,a.jsx)("div",{className:"flex flex-col w-full items-start",children:(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between my-1",children:[(0,a.jsx)("div",{className:"text-white text-xs",children:"Duration(s)"}),(0,a.jsx)("input",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",type:"number",value:e.animation.duration/1e3,onChange:i=>{let a=1e3*Number(i.target.value),n=a>0?a:0;n<10&&(n=10),t.updateAnimation(e.animation.id,{...e.animation,duration:n})}})]})})}),A=(0,C.Pi)(e=>{let t=l.useContext(N);return(0,a.jsxs)("div",{className:"flex flex-col w-full items-start",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between my-1",children:[(0,a.jsx)("div",{className:"text-white text-xs",children:"Duration(s)"}),(0,a.jsx)("input",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",type:"number",value:e.animation.duration/1e3,onChange:i=>{let a=1e3*Number(i.target.value),n=a>0?a:0;n<10&&(n=10),t.updateAnimation(e.animation.id,{...e.animation,duration:n})}})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between my-1",children:[(0,a.jsx)("div",{className:"text-white text-xs",children:"Direction"}),(0,a.jsxs)("select",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",value:e.animation.properties.direction,onChange:i=>{t.updateAnimation(e.animation.id,{...e.animation,properties:{...e.animation.properties,direction:i.target.value}})},children:[(0,a.jsx)("option",{value:"left",children:"Left"}),(0,a.jsx)("option",{value:"right",children:"Right"}),(0,a.jsx)("option",{value:"top",children:"Top"}),(0,a.jsx)("option",{value:"bottom",children:"Bottom"})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between my-1",children:[(0,a.jsx)("div",{className:"text-white text-xs",children:"Use Mask"}),(0,a.jsx)("input",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",type:"checkbox",checked:e.animation.properties.useClipPath,onChange:i=>{t.updateAnimation(e.animation.id,{...e.animation,properties:{...e.animation.properties,useClipPath:i.target.checked}})}})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between my-1",children:[(0,a.jsx)("div",{className:"text-white text-xs",children:"Type"}),(0,a.jsxs)("select",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",value:e.animation.properties.textType,onChange:i=>{t.updateAnimation(e.animation.id,{...e.animation,properties:{...e.animation.properties,textType:i.target.value}})},children:[(0,a.jsx)("option",{value:"none",children:"None"}),(0,a.jsx)("option",{value:"character",children:"Character"})]})]})]})}),M=(0,C.Pi)(()=>{let e=l.useContext(N),t=e.selectedElement,i=e.animations.filter(e=>e.targetId===(null==t?void 0:t.id)),n=i.some(e=>"fadeIn"===e.type),s=i.some(e=>"fadeOut"===e.type),o=i.some(e=>"slideIn"===e.type),d=i.some(e=>"slideOut"===e.type),c=i.some(e=>"breathe"===e.type);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Animations"}),t&&!n?(0,a.jsx)("div",{className:"text-sm px-[16px] py-[8px] font-semibold hover:bg-slate-700 hover:text-white cursor-pointer",onClick:()=>{var i;e.addAnimation({id:r(),type:"fadeIn",targetId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",duration:1e3,properties:{}})},children:"Add Fade In"}):null,t&&!s?(0,a.jsx)("div",{className:"text-sm px-[16px] py-[8px] font-semibold hover:bg-slate-700 hover:text-white cursor-pointer",onClick:()=>{var i;e.addAnimation({id:r(),type:"fadeOut",targetId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",duration:1e3,properties:{}})},children:"Add Fade Out"}):null,t&&!o?(0,a.jsx)("div",{className:"text-sm px-[16px] py-[8px] font-semibold hover:bg-slate-700 hover:text-white cursor-pointer",onClick:()=>{var i;e.addAnimation({id:r(),type:"slideIn",targetId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",duration:1e3,properties:{direction:"left",useClipPath:!1,textType:"none"}})},children:"Add Slide In"}):null,t&&!d?(0,a.jsx)("div",{className:"text-sm px-[16px] py-[8px] font-semibold hover:bg-slate-700 hover:text-white cursor-pointer",onClick:()=>{var i;e.addAnimation({id:r(),type:"slideOut",targetId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",duration:1e3,properties:{direction:"right",useClipPath:!1,textType:"none"}})},children:"Add Slide Out"}):null,t&&!c?(0,a.jsx)("div",{className:"text-sm px-[16px] py-[8px] font-semibold hover:bg-slate-700 hover:text-white cursor-pointer",onClick:()=>{var i;e.addAnimation({id:r(),type:"breathe",targetId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",duration:1e3,properties:{}})},children:"Add Breathing"}):null,i.map(e=>(0,a.jsx)(I,{animation:e},e.id))]})}),O=(0,C.Pi)(e=>{let{audio:t,index:i}=e,n=l.useContext(N),s=l.useRef(null),[r,o]=l.useState("00:00");return(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden items-center bg-slate-800 m-[15px] flex flex-col relative min-h-[100px]",children:[(0,a.jsx)("div",{className:"bg-[rgba(0,0,0,.25)] text-white py-1 absolute text-base top-2 right-2",children:r}),(0,a.jsx)("button",{className:"hover:bg-[#00a0f5] bg-[rgba(0,0,0,.25)] rounded z-10 text-white font-bold py-1 absolute text-lg bottom-2 right-2",onClick:()=>n.addAudio(i),children:(0,a.jsx)(T.x06,{size:"25"})}),(0,a.jsx)("audio",{onLoadedData:()=>{var e,t;let i=null!==(t=null===(e=s.current)||void 0===e?void 0:e.duration)&&void 0!==t?t:0;o(c(i))},ref:s,className:"max-h-[100px] max-w-[150px] min-h-[50px] min-w-[100px]",src:t,id:"audio-".concat(i)})]})}),P=e=>(0,a.jsxs)("label",{htmlFor:"fileInput",className:e.className,children:[(0,a.jsx)("input",{id:"fileInput",type:"file",accept:e.accept,className:"hidden",onChange:e.onChange}),"Upload"]}),L=(0,C.Pi)(()=>{let e=l.useContext(N);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Add Audio"}),e.audios.map((e,t)=>(0,a.jsx)(O,{audio:e,index:t},e)),(0,a.jsx)(P,{accept:"audio/mp3,audio/*",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold text-center mx-2 py-2 px-4 rounded",onChange:t=>{var i;let a=null===(i=t.target.files)||void 0===i?void 0:i[0];a&&e.addAudioResource(URL.createObjectURL(a))}})]})});var W=i(1014);let z=["#000000","#FFFFFF","#404040","#808080","#C0C0C0","#E0E0E0","#003366","#336699","#6699CC","#99CCFF","#990000","#CC3333","#FF6666","#663300","#996633","#CC9966","#006600","#339933","#66CC99","#FFFF00"],R=(0,C.Pi)(()=>{let e=l.useContext(N);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Fill"}),(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(W.if,{colors:z,color:e.backgroundColor,onChangeComplete:t=>{console.log(t),e.setBackgroundColor(t.hex)}})})]})}),V=(0,C.Pi)(e=>{let{image:t,index:i}=e,n=l.useContext(N),s=l.useRef(null),[r,o]=l.useState({w:0,h:0});return(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden items-center bg-slate-800 m-[15px] flex flex-col relative",children:[(0,a.jsxs)("div",{className:"bg-[rgba(0,0,0,.25)] text-white py-1 absolute text-base top-2 right-2",children:[r.w,"x",r.h]}),(0,a.jsx)("button",{className:"hover:bg-[#00a0f5] bg-[rgba(0,0,0,.25)] rounded z-10 text-white font-bold py-1 absolute text-lg bottom-2 right-2",onClick:()=>n.addImage(i),children:(0,a.jsx)(T.x06,{size:"25"})}),(0,a.jsx)("img",{onLoad:()=>{var e,t,i,a;o({w:null!==(i=null===(e=s.current)||void 0===e?void 0:e.naturalWidth)&&void 0!==i?i:0,h:null!==(a=null===(t=s.current)||void 0===t?void 0:t.naturalHeight)&&void 0!==a?a:0})},ref:s,className:"max-h-[100px] max-w-[150px]",src:t,height:200,width:200,id:"image-".concat(i)})]})}),X=(0,C.Pi)(()=>{let e=l.useContext(N);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Add Image"}),e.images.map((e,t)=>(0,a.jsx)(V,{image:e,index:t},e)),(0,a.jsx)(P,{accept:"image/*",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold text-center mx-2 py-2 px-4 rounded",onChange:t=>{var i;let a=null===(i=t.target.files)||void 0===i?void 0:i[0];a&&e.addImageResource(URL.createObjectURL(a))}})]})}),D=e=>{let{fontSize:t,fontWeight:i,sampleText:n}=e,s=l.useContext(N);return(0,a.jsxs)("div",{className:"items-center bg-slate-800 m-[15px] flex flex-row",children:[(0,a.jsx)("div",{className:"flex-1 text-white px-2 py-1",style:{fontSize:"".concat(t,"px"),fontWeight:"".concat(i),fontFamily:s.fontFamily},children:n}),(0,a.jsx)("button",{className:"hover:bg-[#00a0f5] bg-[rgba(0,0,0,.25)] rounded z-10 text-white font-bold py-1",onClick:()=>s.addText({text:n,fontSize:t,fontWeight:i}),children:(0,a.jsx)(T.x06,{size:"25"})})]})},U=(0,C.Pi)(()=>(0,a.jsxs)("div",{className:"bg-slate-800 h-full",children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold text-white",children:"Add Text"}),(0,a.jsx)(D,{sampleText:"Title",fontSize:28,fontWeight:400}),(0,a.jsx)(D,{sampleText:"Subtitle",fontSize:16,fontWeight:400}),(0,a.jsx)(D,{sampleText:"Body",fontSize:14,fontWeight:400}),(0,a.jsx)(D,{sampleText:"Caption",fontSize:12,fontWeight:400}),(0,a.jsx)(D,{sampleText:"Heading 1",fontSize:42,fontWeight:400})]})),Y=(0,C.Pi)(e=>{let{video:t,index:i}=e,n=l.useContext(N),s=l.useRef(null),[r,o]=l.useState("00:00");return(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden items-center bg-slate-800 m-[15px] flex flex-col relative",children:[(0,a.jsx)("div",{className:"bg-[rgba(0,0,0,.25)] text-white py-1 absolute text-base top-2 right-2",children:r}),(0,a.jsx)("button",{className:"hover:bg-[#00a0f5] bg-[rgba(0,0,0,.25)] rounded z-10 text-white font-bold py-1 absolute text-lg bottom-2 right-2",onClick:()=>n.addVideo(i),children:(0,a.jsx)(T.x06,{size:"25"})}),(0,a.jsx)("video",{onLoadedData:()=>{var e,t;let i=null!==(t=null===(e=s.current)||void 0===e?void 0:e.duration)&&void 0!==t?t:0;o(c(i))},ref:s,className:"max-h-[100px] max-w-[150px]",src:t,height:200,width:200,id:"video-".concat(i)})]})}),B=(0,C.Pi)(()=>{let e=l.useContext(N);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Add Video"}),e.videos.map((e,t)=>(0,a.jsx)(Y,{video:e,index:t},e)),(0,a.jsx)(P,{accept:"video/mp4,video/x-m4v,video/*",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold text-center mx-2 py-2 px-4 rounded",onChange:t=>{var i;let a=null===(i=t.target.files)||void 0===i?void 0:i[0];a&&e.addVideoResource(URL.createObjectURL(a))}})]})}),_={blackAndWhite:"Black and White",none:"None",saturate:"Saturate",sepia:"Sepia",invert:"Invert"},H=(0,C.Pi)(e=>{let t=l.useContext(N);return(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden items-center bg-slate-800 m-[15px] flex flex-col relative min-h-[100px] p-2",children:[(0,a.jsx)("div",{className:"flex flex-row justify-between w-full",children:(0,a.jsx)("div",{className:"text-white py-1 text-base text-left w-full",children:_[e.editorElement.properties.effect.type]})}),(0,a.jsx)("select",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",value:e.editorElement.properties.effect.type,onChange:i=>{let a=i.target.value;t.updateEffect(e.editorElement.id,{type:a})},children:Object.keys(_).map(e=>(0,a.jsx)("option",{value:e,children:_[e]},e))})]})}),q=(0,C.Pi)(()=>{let e=l.useContext(N),t=e.selectedElement;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Effects"}),t&&(E(t)||w(t))?(0,a.jsx)(H,{editorElement:t}):null]})}),K=(0,C.Pi)(()=>{let e=l.useContext(N),t=e.selectedMenuOption;return(0,a.jsxs)(a.Fragment,{children:["Video"===t?(0,a.jsx)(B,{}):null,"Audio"===t?(0,a.jsx)(L,{}):null,"Image"===t?(0,a.jsx)(X,{}):null,"Text"===t?(0,a.jsx)(U,{}):null,"Animation"===t?(0,a.jsx)(M,{}):null,"Effect"===t?(0,a.jsx)(q,{}):null,"Export"===t?(0,a.jsx)(k,{}):null,"Fill"===t?(0,a.jsx)(R,{}):null]})}),Z=(0,C.Pi)(e=>{var t;let i=l.useContext(N),{element:n}=e,s="video"===n.type?T.laJ:T.FxN,r=(null===(t=i.selectedElement)||void 0===t?void 0:t.id)===n.id,o=r?"rgba(0, 160, 245, 0.1)":"";return(0,a.jsxs)("div",{style:{backgroundColor:o},className:"flex mx-2 my-1 py-2 px-1 flex-row justify-start items-center ".concat(o," max-w-[200px]"),onClick:()=>{i.setSelectedElement(n)},children:[(0,a.jsx)(s,{size:"20",color:"gray"}),(0,a.jsx)("div",{className:"truncate text-xs ml-2 flex-1 font-medium",children:n.name}),(0,a.jsxs)("div",{children:["video"===n.type?(0,a.jsx)("video",{className:"opacity-0 max-w-[20px] max-h-[20px]",src:n.properties.src,onLoad:()=>{i.refreshElements()},onLoadedData:()=>{i.refreshElements()},height:20,width:20,id:n.properties.elementId}):null,"image"===n.type?(0,a.jsx)("img",{className:"opacity-0 max-w-[20px] max-h-[20px]",src:n.properties.src,onLoad:()=>{i.refreshElements()},onLoadedData:()=>{i.refreshElements()},height:20,width:20,id:n.properties.elementId}):null,"audio"===n.type?(0,a.jsx)("audio",{className:"opacity-0 max-w-[20px] max-h-[20px]",src:n.properties.src,onLoad:()=>{i.refreshElements()},onLoadedData:()=>{i.refreshElements()},id:n.properties.elementId}):null]}),(0,a.jsx)("button",{className:"bg-red-500 hover:bg-red-700 text-white mr-2 text-xs py-0 px-1 rounded",onClick:e=>{i.removeEditorElement(n.id),i.refreshElements(),e.preventDefault(),e.stopPropagation()},children:"X"})]},n.id)}),G=(0,C.Pi)(e=>{let t=l.useContext(N);return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex flex-row justify-between",children:(0,a.jsx)("div",{className:"text-sm px-[16px] py-[7px] font-semibold",children:"Elements"})}),(0,a.jsx)("div",{className:"flex flex-col",children:t.editorElements.map(e=>(0,a.jsx)(Z,{element:e},e.id))})]})}),Q=(0,C.Pi)(()=>{let e=l.useContext(N);return(0,a.jsx)(a.Fragment,{children:J.map(t=>(0,a.jsxs)("button",{onClick:()=>t.action(e),className:"py-4 px-2 w-full flex flex-col items-center text-xs",children:[(0,a.jsx)(t.icon,{className:"",size:"20",color:e.selectedMenuOption===t.name?"#00a0f5":"black"}),(0,a.jsx)("div",{className:e.selectedMenuOption===t.name?"font-semibold":"font-light",children:t.name})]},t.name))})}),J=[{name:"Video",icon:T.dnC,action:e=>{e.setSelectedMenuOption("Video")}},{name:"Audio",icon:T.ibD,action:e=>{e.setSelectedMenuOption("Audio")}},{name:"Image",icon:T.e0s,action:e=>{e.setSelectedMenuOption("Image")}},{name:"Text",icon:T.SQS,action:e=>{e.setSelectedMenuOption("Text")}},{name:"Animation",icon:T.mi9,action:e=>{e.setSelectedMenuOption("Animation")}},{name:"Effects",icon:T._9Q,action:e=>{e.setSelectedMenuOption("Effect")}},{name:"Fill",icon:T.Yu2,action:e=>{e.setSelectedMenuOption("Fill")}},{name:"Export",icon:T.uKn,action:e=>{e.setSelectedMenuOption("Export")}}];var $=i(9308);let ee=(0,$.Pi)(e=>{let t=(0,l.useContext)(N),i=t.playing?T.hPq:T.Nhx,n=m(t.currentTimeInMs),s=m(t.maxTime);return(0,a.jsxs)("div",{className:"seek-player flex flex-col",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center px-2",children:[(0,a.jsx)("button",{className:"w-[80px] rounded  px-2 py-2",onClick:()=>{t.setPlaying(!t.playing)},children:(0,a.jsx)(i,{size:"40"})}),(0,a.jsx)("span",{className:"font-mono",children:n}),(0,a.jsx)("div",{className:"w-[1px] h-[25px] bg-slate-300 mx-[10px]"}),(0,a.jsx)("span",{className:"font-mono",children:s})]}),(0,a.jsx)("input",{className:"flex-1",type:"range",min:0,max:t.maxTime,value:t.currentTimeInMs,onChange:e=>{t.handleSeek(parseInt(e.target.value))}})]})});var et=function(e){let t=(0,l.useRef)({div:null,isDragging:!1,initialMouseX:0}),{current:i}=t;function n(t){if(!i.div)return 0;let a=t-i.initialMouseX,n=a/i.div.parentElement.clientWidth*e.total;return e.value+n}let s=t=>{i.div&&i.isDragging&&(i.div.style.left="".concat(n(t.clientX)/e.total*100,"%"),t.stopPropagation(),t.preventDefault())},r=t=>{i.div&&i.isDragging&&(i.isDragging=!1,e.onChange(n(t.clientX)),t.stopPropagation(),t.preventDefault())};return(0,l.useEffect)(()=>(window.addEventListener("mouseup",r),window.addEventListener("mousemove",s),()=>{window.removeEventListener("mouseup",r),window.removeEventListener("mousemove",s)}),[r,s]),(0,a.jsx)("div",{ref:e=>{i.div=e},className:"absolute height-100 ".concat(e.className),style:{left:e.value/e.total*100+"%",top:0,bottom:0,...e.style},onMouseDown:t=>{i.div&&(e.disabled||(i.isDragging=!0,i.initialMouseX=t.clientX))},children:e.children})};let ei=(0,C.Pi)(e=>{var t;let i=l.useContext(N),{element:n}=e,s="audio"===n.type,r=(null===(t=i.selectedElement)||void 0===t?void 0:t.id)===n.id,o=s?"cursor-no-drop":"cursor-ew-resize";return(0,a.jsxs)("div",{onClick:()=>{i.setSelectedElement(n)},className:"relative width-full h-[25px] my-2 ".concat(r?"border-2 border-indigo-600 bg-slate-200":""),children:[(0,a.jsx)(et,{className:"z-10",value:n.timeFrame.start,total:i.maxTime,disabled:s,onChange:e=>{i.updateEditorElementTimeFrame(n,{start:e})},children:(0,a.jsx)("div",{className:"bg-white border-2 border-blue-400 w-[10px] h-[10px] mt-[calc(25px/2)] translate-y-[-50%] transform translate-x-[-50%] ".concat(o)})}),(0,a.jsx)(et,{className:s?"cursor-no-drop":"cursor-col-resize",value:n.timeFrame.start,disabled:s,style:{width:"".concat((n.timeFrame.end-n.timeFrame.start)/i.maxTime*100,"%")},total:i.maxTime,onChange:e=>{let{start:t,end:a}=n.timeFrame;i.updateEditorElementTimeFrame(n,{start:e,end:e+(a-t)})},children:(0,a.jsx)("div",{className:"".concat(r?"bg-slate-800":"bg-slate-600"," h-full w-full text-white text-xs min-w-[0px] px-2 leading-[25px]"),children:n.name})}),(0,a.jsx)(et,{className:"z-10",disabled:s,value:n.timeFrame.end,total:i.maxTime,onChange:e=>{i.updateEditorElementTimeFrame(n,{end:e})},children:(0,a.jsx)("div",{className:"bg-white border-2 border-blue-400 w-[10px] h-[10px] mt-[calc(25px/2)] translate-y-[-50%] transform translate-x-[-50%] ".concat(o)})})]},n.id)}),ea=(0,C.Pi)(()=>{let e=l.useContext(N),t=e.currentTimeInMs/e.maxTime*100;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ee,{}),(0,a.jsxs)("div",{className:"relative height-auto",children:[(0,a.jsx)("div",{className:"w-[2px] bg-red-400 absolute top-0 bottom-0 z-20",style:{left:"".concat(t,"%")}}),e.editorElements.map(e=>(0,a.jsx)(ei,{element:e},e.id))]})]})}),en=()=>{let[e]=(0,l.useState)(new y);return(0,a.jsx)(N.Provider,{value:e,children:(0,a.jsx)(ed,{})})},el=e=>new Promise((t,i)=>{let a=document.createElement("video");a.preload="metadata",a.onloadedmetadata=()=>{window.URL.revokeObjectURL(a.src),t(a.duration)},a.src=e}),es=(e,t)=>{let i="/toonplates-static/rick-morty-chalkboard/rick-morty-chalkboard.mp4";!(e.videos.length>0)&&t&&setTimeout(()=>{e.addVideoResource(i),el(i).then(i=>{setTimeout(()=>{e.setMaxTime(1e3*i),e.addVideo(0,t.width),e.setFontFamily("VillainTeamUpItal"),e.addImage("/toonplates-static/rick-morty-chalkboard/chalkboard.png",{width:963,height:541,x:-2,y:0,start:1852,end:3136+1e3/23.976*39}),e.addImage("/toonplates-static/rick-morty-chalkboard/line.png",{width:1920,height:1080,x:0,y:0,scale:.5,start:3136+1e3/23.976*39,end:6967});let a=e.editorElements[e.editorElements.length-1];setTimeout(()=>{e.addAnimation({id:r(),type:"positionAndScale",targetId:a.id,duration:400,properties:{x:1,y:1,scale:.42,startDelay:0,easing:"easeOutSine"}})},1e3),e.addImage("/toonplates-static/logo.png",{width:640,height:85,scale:.5,x:620,y:22,start:0,end:e.maxTime})},1e3)})},10)},er=(e,t,i,a,n)=>new Promise((t,l)=>{e.editorElements.forEach(t=>{t.name.startsWith("chalkboard")&&e.removeEditorElement(t.id)});let s=()=>{e.handleSeek(0),e.setSelectedElement(null),setTimeout(()=>{e.saveCanvasToVideoWithAudio()},1e3)};document.querySelector("video.example-gag").pause(),document.querySelector("video.preload").pause(),[...document.querySelectorAll("img.preload")].forEach(e=>{e.remove()}),e.setIsExporting(!0),setTimeout(()=>{let l=0,o=0;i.split("").forEach((t,i)=>{let a=-9;if(l>233&&(a=(l-233)/5.5-9),i<3&&(a=Math.sin(-((3-i)*3)*Math.PI/180)*(180/Math.PI)-9)," "===t){l+=13*Math.cos(a*Math.PI/180),o+=13*Math.sin(a*Math.PI/180);return}let n=105+o,s=270+l;0===i&&(n-=3,s+=5,a=-5),1===i&&(n-=2),e.addText({name:"chalkboard-letter-".concat(i),text:t,fontSize:64,fontWeight:200,width:100,x:s,y:n,rotation:a,fill:"#f3d7d4"});let d=e.editorElements[e.editorElements.length-1];l+=(d.fabricObject.dynamicMinWidth+2)*Math.cos(a*Math.PI/180),o+=(d.fabricObject.dynamicMinWidth+2)*Math.sin(a*Math.PI/180),i>8&&(l+=1),e.updateEditorElementTimeFrame(d,{start:1852,end:6967}),e.addAnimation({id:r(),type:"positionAndScale",targetId:d.id,duration:400,properties:{x:.84*s,y:.84*n,scale:.8,startDelay:2900,easing:"easeOutSine"}})}),e.setFontFamily("VillainTeamUpItal");for(let t=0;t<10;t++){e.addText({name:"chalkboard-text-".concat(t),text:a[t].toLowerCase(),fontSize:50,fontWeight:400,width:1920,x:85,y:190+46*t});let i=e.editorElements[e.editorElements.length-1];if(e.addAnimation({id:r(),type:"positionAndScale",targetId:i.id,duration:400,properties:{x:85*.84,y:160+38*t,scale:.84,startDelay:2900,easing:"easeOutSine"}}),e.updateEditorElementTimeFrame(i,{start:1852,end:6967}),3!==t&&n[t]){e.addImage("/toonplates-static/rick-morty-chalkboard/line.png",{name:"chalkboard-line-"+t,width:1920,height:1080,x:0,y:46*t-140,scale:.5,start:1852,end:6967});let i=e.editorElements[e.editorElements.length-1];e.addAnimation({id:r(),type:"positionAndScale",targetId:i.id,duration:400,properties:{x:0,y:(46*t-140)*.84,scale:.42,startDelay:2900,easing:"easeOutSine"}})}}let d=3136;for(let t=1;t<=39;t++)(t=>{new Image;let i=d+1,a=Math.ceil(i+1e3/23.976);d=a;let n="/toonplates-static/rick-morty-chalkboard/frames/frame-".concat(t.toString().padStart(4,"0"),".png");e.addImage(n,{name:"chalkboard-frame-"+t,width:960,height:540,x:0,y:0,start:i,end:a})})(t);setTimeout(()=>{s(),setTimeout(()=>{t()},e.maxTime)},3e3)},2e3)}),eo=(e,t)=>{let i=(0,l.useRef)(null),n=(0,l.useRef)(Array(10).fill(0).map(()=>null)),[s,r]=(0,l.useState)(!1),o=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);(0,l.useRef)(null);let d="block w-full mt-1 border-gray-200 rounded-md focus:border-indigo-600 focus:ring focus:ring-opacity-40 focus:ring-indigo-500 VillainTeamUpItal";if(es(e,t),!t)return null;let c=[];for(let e=1;e<=39;e++){let t=e.toString().padStart(4,"0");c.push((0,a.jsx)("img",{src:"/toonplates-static/rick-morty-chalkboard/frames/frame-".concat(t,".png"),className:"hide-but-render preload"}))}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"wrapper bg-gray-200 font-roboto",children:(0,a.jsxs)("div",{className:"container mx-auto px-6 py-8",children:[(0,a.jsx)("video",{src:"/toonplates-static/rick-morty-chalkboard/example.mp4",className:"example-gag",loop:!0,muted:!0,autoPlay:!0}),(0,a.jsx)("video",{src:"/toonplates-static/rick-morty-chalkboard/rick-morty-chalkboard.mp4",className:"hide-but-render preload",autoPlay:!0,muted:!0}),(0,a.jsx)("img",{src:"/toonplates-static/rick-morty-chalkboard/chalkboard.png",className:"hide-but-render preload"}),(0,a.jsx)("img",{src:"/toonplates-static/rick-morty-chalkboard/line.png",className:"hide-but-render preload"}),c,(0,a.jsx)("p",{className:"desc mt-4",children:"Create a video gag just like this one! Write your lines below!"}),(0,a.jsxs)("form",{onSubmit:a=>{var l;a.preventDefault();let s=n.current.map(e=>e.value||""),o=(null==i?void 0:null===(l=i.current)||void 0===l?void 0:l.value)||"",d=n.current.map(e=>{var t,i;return(null===(i=e.parentElement)||void 0===i?void 0:null===(t=i.parentElement)||void 0===t?void 0:t.querySelector('[type="checkbox"]')).checked});er(e,t,o,s,d).then(()=>{r(!0)})},children:[(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)("div",{className:"px-4 py-4 overflow-x-auto bg-white rounded-md",children:[(0,a.jsx)("label",{className:"block flex-1",children:(0,a.jsx)("input",{type:"text",ref:i,className:d,placeholder:'Write the chalkboard title here! (e.g "Morty bets")'})}),Array(10).fill(0).map((e,t)=>(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("label",{className:"block",children:(0,a.jsx)("input",{type:"text",className:d,name:"text-".concat(t),ref:e=>n.current[t]=e,placeholder:"Write the line #".concat(t+1," here")})}),(0,a.jsxs)("label",{children:[(0,a.jsx)("input",{type:"checkbox",className:"w-5 h-5 text-indigo-600 rounded-md focus:ring-indigo-500",name:"line-through-".concat(t),defaultChecked:3===t,disabled:3===t}),(0,a.jsx)("span",{className:"ml-2 text-gray-700",children:"Strikethrough"})]})]},"text-".concat(t)))]})}),s&&o&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("p",{className:"black",children:"If the video looks glitched please try again on a desktop computer! Sorry about this \uD83D\uDE2D"})}),(0,a.jsx)("input",{disabled:e.isExporting,type:"submit",value:e.isExporting?"Working, don't move...":"Generate video",name:"",id:"",className:"pt-3 pb-2 bg-palette-primary text-white w-full mt-2 rounded-sm font-primary font-semibold text-xl flex    justify-center items-baseline  hover:bg-palette-dark"})]})]})}),(0,a.jsxs)("div",{className:"footer",children:[(0,a.jsx)("a",{href:"mailto:ivanca@gmail.com",children:"Ivan Castellanos"})," - All rights reserved \xa9 2023"]})]})},ed=(0,C.Pi)(()=>{let e=l.useContext(N),[t,i]=(0,l.useState)(void 0);return(0,l.useEffect)(()=>{let t=new n.fabric.Canvas("canvas",{height:540,width:960,backgroundColor:"#ededed"});i(t),n.fabric.Object.prototype.transparentCorners=!1,n.fabric.Object.prototype.cornerColor="#00a0f5",n.fabric.Object.prototype.cornerStyle="circle",n.fabric.Object.prototype.cornerStrokeColor="#0063d8",n.fabric.Object.prototype.cornerSize=10,t.on("mouse:down",function(t){t.target||e.setSelectedElement(null)}),e.setCanvas(t),n.fabric.util.requestAnimFrame(function e(){t.renderAll(),n.fabric.util.requestAnimFrame(e)})},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"hide-but-render grid grid-rows-[20px_540px_1fr] grid-cols-[60px_200px_960px_1fr] h-[100%]",children:[(0,a.jsx)("div",{className:"tile row-span-2 flex flex-col",children:(0,a.jsx)(Q,{})}),(0,a.jsx)("div",{className:"row-span-2 flex flex-col overflow-auto",children:(0,a.jsx)(K,{})}),(0,a.jsx)("canvas",{id:"canvas",className:"h-[540px] w-[960px] row col-start-3"}),(0,a.jsx)("div",{className:"col-start-4 row-start-2",children:(0,a.jsx)(G,{})}),(0,a.jsx)("div",{className:"col-start-3 row-start-3 col-span-2 relative overflow-scroll px-[10px] py-[4px]",children:(0,a.jsx)(ea,{})})]}),(0,a.jsx)("div",{children:eo(e,t)})]})})}}]);